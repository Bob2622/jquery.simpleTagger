/*! jquery.simpleTagger 0.1.0 (https://github.com/jpapillon/jquery.simpleTagger/) */
!function(a){"use strict";function b(b,c){var d=this;this.options=c,this.$select=b,this.$select.hide(),this.$select.wrapAll(a('<div class="tagger-container" />')),this.$container=b.parents(".tagger-container"),this.$inputContainer=a('<div class="input-container" />'),this.$input=a('<input type="text" />'),this.$placeholder=a('<span class="placeholder">'+(this.options.placeholderText?this.options.placeholderText:"")+"</span>"),this.$inputContainer.append(this.$input).append(this.$placeholder),this.$select.after(this.$inputContainer),this.$select.find("option").each(function(){var b=a(this).val();a(this).val(b).text(b),d.addTag(b)}),this.$select.is(":disabled")?this.disable():this.enable(),this.adjustInputWidth()}var c={addKeys:[9,13],placeholderText:"Add...",maxNbTags:!1,confirmDelete:!1,caseSensitive:!1,disableAdd:!1,attrValue:null,createFn:function(a){return a}};b.prototype={constructor:b,getTags:function(){var b=[];return this.$container.find(".tagger-tag").each(function(){b.push(a(this).data("value"))}),b},getTagIdentifier:function(a){var b=a.data("value");return this.options.attrValue?b[this.options.attrValue]:b},findTag:function(b){var c=this;return this.$container.find(".tagger-tag").filter(function(){var d=c.getTagIdentifier(a(this)),e=b;return c.options.caseSensitive&&(d=d.toLowerCase(),e=e.toLowerCase()),d===e})},addTag:function(b){var c=!1;if(b=a.trim(b||this.$input.val()),""!==b){var d=this.findTag(b);if(d.length>0)d.css("opacity",0).animate({opacity:1},300);else{c=!0;var e=this.getCalculatedTag(b);e.data("value",this.options.createFn(b)),this.$inputContainer.before(e),this.inputReset(),0===this.$select.find('option[value="'+b+'"]').length&&this.$select.append('<option value="'+b+'"/>')}}return c},removeTag:function(b){var c=this;this.$container.find(".tagger-tag").filter(function(){return c.getTagIdentifier(a(this))===b}).remove(),this.$select.find('option[value="'+b+'"]').remove()},removeTags:function(){this.$container.find(".tagger-tag").remove(),this.$select.find("option").remove()},setTags:function(a){this.removeTags();for(var b=0;b<a.length;b++)this.addTag(a[b])},reachedNbMaxTags:function(){return this.options.maxNbTags&&this.getTags().length>=this.options.maxNbTags},addTagFromKeyboard:function(a){this.options.disableAdd||this.addTag(a)},enable:function(){this.setEvents(),this.$input.prop("disabled",!1),this.$container.removeClass("tagger-disabled")},disable:function(){this.unsetEvents(),this.$input.prop("disabled",!0),this.$container.addClass("tagger-disabled")},setEvents:function(){var b=this;this.options.disableAdd||this.$input.on("blur",function(){b.addTagFromKeyboard(b.$input.val()),b.$input.val(""),b.$placeholder.show();var a=b.$container.find(".tagger-tag");a.removeClass("confirm"),a.last().after(b.$inputContainer)}),this.$input.on("paste",function(c){if(b.$placeholder.hide(),b.reachedNbMaxTags())c.preventDefault(),c.stopPropagation();else{var d=this;setTimeout(function(){b.adjustInputWidth(a(d).val())},0)}}),this.$input.on("keyup",function(){0===b.$input.val().length?b.$placeholder.show():b.$placeholder.hide(),b.adjustInputWidth()}),this.$input.on("keydown",function(a){var c=b.$input.val();switch(a.which){case 8:case 46:if(0===c.length){var d;d=8===a.which?b.$inputContainer.prev(".tagger-tag"):b.$inputContainer.next(".tagger-tag"),b.options.confirmDelete?(d.siblings().removeClass("confirm"),d.hasClass("confirm")?b.removeTag(b.getTagIdentifier(d)):d.addClass("confirm")):b.removeTag(b.getTagIdentifier(d))}break;case 37:0===c.length&&b.goToPreviousTag();break;case 39:0===c.length&&b.goToNextTag()}8!==a.keyCode&&46!==a.keyCode&&b.$container.find(".tagger-tag").removeClass("confirm")}),this.$input.on("keypress",function(c){b.$input.val();switch(8!==c.keyCode&&46!==c.keyCode&&b.$container.find(".tagger-tag").removeClass("confirm"),c.keyCode){case 8:case 46:break;default:-1!==a.inArray(c.keyCode,b.options.addKeys)?(""!==a.trim(b.$input.val())&&(b.addTagFromKeyboard()&&b.$placeholder.show(),c.preventDefault(),c.stopPropagation()),b.adjustInputWidth()):!c.ctrlKey&&b.reachedNbMaxTags()?(c.preventDefault(),c.stopPropagation()):(b.$container.find(".tagger-tag").removeClass("confirm"),b.$placeholder.hide(),b.adjustInputWidth(b.$input.val()+String.fromCharCode(c.which)))}}),this.$container.on("click",function(){b.$input.focus()}),this.$container.on("click",".tagger-tag .remove-tag",function(c){b.removeTag(b.getTagIdentifier(a(c.target).parents(".tagger-tag")))})},unsetEvents:function(){this.$input.off("blur"),this.$input.off("paste"),this.$input.off("keyup"),this.$input.off("keydown"),this.$input.off("keypress"),this.$container.off("click",".tagger-tag .remove-tag"),this.$container.off("click")},goToPreviousTag:function(){this.$inputContainer.prevAll(".tagger-tag").first().before(this.$inputContainer),this.inputReset()},goToNextTag:function(){this.$inputContainer.nextAll(".tagger-tag").first().after(this.$inputContainer),this.inputReset()},inputReset:function(){this.$input.val("");var a=this;setTimeout(function(){a.$input.focus()},10),this.adjustInputWidth()},getCalculatedTag:function(b){var c=a("#tagger-widthCalculator");0===c.length&&(c=a('<div id="tagger-widthCalculator" class="tagger-tag" />').css({position:"absolute",top:-9999,left:-9999,whiteSpace:"nowrap"}),a("body").append(c));var e=function(a){c.html(d(a))};e(b);var f=c.outerWidth(),g=this.$container.width(),h=f>g,i=function(b){e(b);var f=c.outerWidth();if(g>=f)return c.html(d(b)+'<span class="remove-tag">&times;</span>'),f=c.outerWidth(),g>=f?d(b)+'<span class="remove-tag">&times;</span>':d(b)+'<br /><span class="remove-tag">&times;</span>';var h=g/f,j=parseInt(b.length*h,10);e(b.substr(0,j)),f=c.outerWidth();var k=!1;if(f>g)for(;f>g;)k=!0,j--,e(b.substr(0,j)),f=c.outerWidth();else{for(;g>f;)j++,e(b.substr(0,j)),f=c.outerWidth();j--}var l=b.substr(0,j),m=l.lastIndexOf(" ");return-1!==m&&(j=m),d(b.substr(0,j))+"<br />"+i(a.trim(b.substr(j)))};return a('<div class="tagger-tag'+(h?" full-width":"")+'">'+i(b)+"</div>")},adjustInputWidth:function(b){b=b||this.$input.val(),a("taggerWidth").remove();var c=a("<taggerWidth/>").css({position:"absolute",top:-9999,left:-9999,fontSize:this.$input.css("fontSize"),fontFamily:this.$input.css("fontFamily"),fontWeight:this.$input.css("fontWeight"),letterSpacing:this.$input.css("letterSpacing"),whiteSpace:"nowrap"});c.html(d(b)),a("body").append(c);var e=c.width(),f=0;this.options.placeholderText&&(c.html(d(this.options.placeholderText)),f=c.width());var g=Math.max(e,f),h=this.$input.outerWidth()-this.$input.width();this.$input.width(Math.min(this.$container.width()-h,g+1))}};var d=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/ /g,"&nbsp;")};a.fn.simpleTagger=function(d,e){var f=a(this).data("tagger");if(!f){var g=a.extend({},c,d);return this.each(function(){var c=new b(a(this),g);a(this).data("tagger",c)})}return f[d]?f[d](e):void 0}}(window.jQuery);